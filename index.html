<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]>      <html class="no-js"> <!--<![endif]-->
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>BANKBOOKZ&#8482;</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="icon" href="./favicon.ico" />
        <script src="./data/default_data.js"></script><!--****************LOAD-CUSTOM-DATA-MODULE******************-->
        <script  > //****************LOAD-CUSTOM-DATA-MODULE******************
            console.log("Imported Data:")
            console.log(`TRADES:${default_raw_trade_data.length}`)
            console.log(`TICKRS, BTC(months):${Object.keys(default_TICKR_DATA_MAP_Monthly['BTC']).length}`)
            console.log(`TICKRS, ETH(months):${Object.keys(default_TICKR_DATA_MAP_Monthly['ETH']).length}`)
            console.log(`BTC_TXNZ: MONTH${Object.keys(default_BTC_TRADEZ).length}`);
        </script>  <!-- **************************END-CUSTOM-DATA-MODULE******************-->      
        <!-- <script type="text/javascript"
            src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script> -->
        <script type="text/javascript" src="./module/derivative_lwc.js"></script>


        
<style>
    body{ background:black; color:steelblue; font-size: 1em;padding: 1em 2% 2% 2%;
        font-family: verdana;height: 100%; min-height: 100%; display: flex;
        flex: 1;flex-direction: column; margin-top:2em;user-select:none;
    }   
    /* FRAME *******************************FRAME*****************************/
    .FRAME{ border:solid 1px steelblue;box-shadow: 1px 1px 3px 0px steelblue;
        border-radius: 10px;padding: 2%;margin: 0.333em;
    }
    .BTN {color:aqua;background:#000033;border:solid 1px seagreen;
        text-align: center;border-radius:13px;box-shadow: 1px 1px 1px teal;
        cursor:pointer;height: 1.444em;
    }
    .BTN:hover{color:lime;border:solid 1px lime;box-shadow:1px 1px 1px black;}
    .BTN:active{color:cyan;background:blue;border:solid 1px teal;box-shadow:1px 1px 1px black;height: 1.444em;}    
    .BTN.selectedMAINBTN{color:cyan;background:darkblue;border:solid 1px teal;}
    .blackBTN.selectedSUBBTN{color:cyan;box-shadow: inset 1px 1px 12px 0px blue;border:solid 1px teal;}
    /* BTN **********************************BTN**************************/
    /* .BTN{background:grey;border-radius: 8px;border:solid 1px darkslateblue;font-size:0.888em;
        cursor:pointer;color:cyan;font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;} */
    .blackBTN{border-radius: 13px;background:black;cursor: pointer;font-size: 0.777em;
        color: aqua;line-height:1;box-shadow:1px 1px 1px aqua;padding: 0.555% 1% 0.555% 1%;}
    /**************RESPONSIVE BTN *******************/
    /* .BTN:hover{border:1px solid steelblue; color:purple}
    .BTN:active{border:1px solid lime; color:green} */
    .blackBTN:hover{border:1px solid lime;  background:black;  color:green}
    .blackBTN:active{border:1px solid steelblue;  background:black; color:purple}
    @media only screen and (max-width: 800px) { /************* TABLET */
        body{  background-color: #00070d;}
        .BTN{font-size:1.111em;}
        /* .blackBTN{font-size:0.999em;} */
    }  
    @media only screen and (max-width: 500px) { /************* PHONE */
        body{ background-color: #07000c; }
        .BTN{font-size:1em;}
        .blackBTN{font-size:1em;}
    }
    /* ***********************************CUSTOM SCROLLBAR****************************/
    .scrollBarV {overflow-x:scroll;}
    .scrollBarV::-webkit-scrollbar-track { background-color: #010213;  border-radius: 13px; }
    .scrollBarV::-webkit-scrollbar { width: 0.666em; height: 100%; }
    .scrollBarV::-webkit-scrollbar-thumb { background-color: #04223c; border-radius: 13px;
        background-image: -webkit-linear-gradient(0deg, rgba(255, 255, 255, 0.6) 26%, transparent 26%, transparent 51%, rgba(255, 255, 255, -0.4) 51%, rgba(255, 255, 255, 0.6) 74%, transparent 74%, transparent);
    } 
    .txtSizer::-webkit-scrollbar{ width:1.222em; background:black;}
    /* option:active {
        background-color: darkslateblue;
        color: aqua;
    }  */
    /*******CUSTOM MAIN MENU *******************MAIN MENU*********************************/
    .MAIN_MENU {background:rgb(72, 80, 111);border:solid 1px rgb(0, 128, 45);border-radius: 13px;
        padding:0.666em 1em 0.666em 1em;box-shadow: inset 0px 3px 10px purple;
        display: flex;justify-content: space-evenly;max-width: 80%;margin: -1em auto 1.111em auto;
        font-size: 0.666em;padding: 0.444em;display: flex;flex:0;
    } 
    .hiddenTab{ display:none !important;}
    /* CUSTOM HR ***************************HR***********************/
    hr {border-top:solid 1px steelblue; border-bottom: none; border-radius: 2px;}    
    /* CUSTOM INPUT ***************************INPUT***********************/
    .inputELEM { border-radius: 13px;text-align: center;background: darkslategrey;
        color: cyan;width:8em;padding: 0;font-size:0.888em;margin: 0.444em 0px;
    }
    /* END CUSTOM INPUT ***************************END INPUT***********************/
    /*******END CUSTOM MAIN MENU *******************MAIN MENU*********************************/
    /* CUSTOM TITLES ***************************TITLES***********************/
    .mainTitle {font-size: 1.444em;display:flex;justify-content: space-between; padding: 0em 1em 0 1em;
        text-shadow: -8px -1px 8px blue;}
    /* CUSTOM EXPANDER ***************************EXPANDER***********************/
    .expanderROW {display:flex;justify-content:space-between;padding: 0.444em 1em 0.444em 1em;border-bottom:1px dashed #021d33}
    .expanderTITLE{font-size:0.888em;color:steelblue;    margin-top: 0.333em;}
    .expanderBTN {color:aqua;background:#000033;border:solid 1px seagreen;
        width: 1.444em;text-align: center;border-radius: 50%;box-shadow: 1px 1px 1px teal;
        cursor:pointer;height: 1.444em;
    }
    .expanderBTN:hover{color:cyan;background:darkblue;border:solid 1px teal;}
    .expanderBTN:active{color:cyan;background:blue;border:solid 1px teal;box-shadow:1px 1px 1px black;
    }
    /** END CUSTOM EXPANDER ******************END EXPANDER*********************************************/   
    /**  **************************SELECTOR*************************************/
    .chartBTN {background:steelblue;border-radius: 10px;border: 1px solid orangered;
        padding: 0.666%;}
    .chartBTN:hover{color:aqua;background:black;}
    .chartSELECTOR {background:black; color:steelblue;border-radius: 10px;border: 1px solid aqua;
        padding: 0.333%;font-size: 1em;height: 1.444em;}
    .chartSELECTOR:hover{color:aqua;background:black;}
    .chartSELECTOR:focus {border-color: teal;
    }/* focus border */
    .chartSELECTOR:focus option:checked {background-color:black;color:limegreen;
    } /* focused item */
    .chartSELECTOR:focus-visible{outline-color: teal;
    } /* focused item */
    /**  *************************END SELECTOR**************************************/      
    /** CUSTOM TV CHARTS *********************CHARTS******************************************/    
    .tv-lightweight-charts{ margin: 1em 0 1em 0; border-radius:13px;}
    /** END  TV CHARTS *************************CHARTS**************************************/   
    /** API ***************************************************************/
    #API_BOX{display:flex;border: solid 1px steelblue;
        border-radius: 13px;padding: 2px 10%;color: #022e64;align-items: center; 
        justify-content: space-between;flex-wrap: wrap;margin: 12px auto 0 auto;
    max-width: 30em;
    min-width: 50%;}
    @media only screen and (max-width: 800px) { /************* TABLET */
        #API_BOX{margin: 8px 10% 0 10%;}
    }  
    @media only screen and (max-width: 500px) { /************* PHONE */
        #API_BOX{margin: 6px 1% 0 1%;}
    }        
    #keyBOX{ margin:1%;border: solid 1px steelblue;font-size: 0.777em;}
    #keyINPUT:-webkit-autofill { -webkit-box-shadow: 0 0 0px 1000px #233453 inset;}
    /** END API ***************************************************************/ 
    /** VIEW IMPLEMENTATIONS ***************************************************/   
    .tkrROWZ{margin: 1%; width:92%; border:solid 1px steelblue; display: flex;justify-content: space-between;
        border-radius:18px;padding: 0 3% 0 3%; align-items: center; flex-wrap: wrap;
    } 
    /** END VIEW IMPLEMENTATIONS *****************************************/   
</style>      
</head>
<body class="scrollBarV">
    <header style="position:absolute;top:0.555em;align-self:center;display:flex;">
        BANKBOOKZ<span style="font-size:0.444em">&#8482;</span></header>
    <menu class="MAIN_MENU">
        <button id="TCKR_VIEW_BTN" class="BTN" style="margin:0 0em 0 0em;" onclick="go_TICKR_VIEW()">TICKRZ</button>
        <button id="BANK_VIEW_BTN" class="BTN" style="margin:0 1em 0 1em;" onclick="go_BANK_VIEW()">BANKZ</button>
        <button id="BOOK_VIEW_BTN" class="BTN" style="margin:0 0em 0 0em;" onclick="go_BOOK_VIEW()">BOOKZ</button>
        <button id="DATA_VIEW_BTN" class="BTN" style="margin:0 1em 0 1em;" onclick="go_DATA_VIEW()">DATA</button>
    </menu>
    <section id="TCKR_VIEW" class=" hiddenTab" style="border: solid 1px steelblue;justify-content: center; 
    flex-direction: column;border-radius: 13px;flex: 1;height: 10em;display: flex;
    padding: 1em 3% 2% 3%;max-width: 50em;margin: 0 10%;align-self: center;width: 88.888%;
    box-shadow: inset 1px 1px 11px 0px cyan;"/> 
    
        <!--style="flex:1;border-radius: 13px; border: solid 1px steelblue; 
        box-shadow: inset 1px 1px 11px 0px cyan; padding:2%;padding-top: 3%;padding-left:4%; 
        max-width:50em;color: cyan;line-height:1.666em;">-->
        <header class="mainTitle expanderROW">
            <span class="boxTitle">
                <span style="font-size:0.777em; color:cyan">1</span>
                <span>TICKERS</span>
                <!-- <span class="expanderBTN" style="font-size:0.777em;" onclick="expander_BOOKZ_Click(event)">✧</span> -->
            </span>
        </header>
        <hr/>
        <article id="TKR_RENDER_FRAME"></article>
        <hr/>
        <menu style="display: flex;justify-content: flex-end; padding-right: 2%;">
            <button id="addTickBtn1" class="blackBTN" onclick="add_TKRZ_Click()">add🎇</button>
            <button id="saveTickBtn1" class="blackBTN" style="margin-left:1em;" onclick="saveTickerClick()">save🌟</button>
        </menu>
    </section><!-- END TCKR VIEW-->
    <section id="BANK_VIEW" class=" hiddenTab" style="border: solid 1px steelblue;justify-content: center; 
    flex-direction: column;border-radius: 13px;flex: 1;height: 10em;display: flex;
    padding: 1em 3% 2% 3%;max-width: 50em;margin: 0 10%;align-self: center;width: 88.888%;
    box-shadow: inset 1px 1px 11px 0px #00ffa5;"/> 
        <!-- style="flex: 1;border-radius: 13px;border: solid 1px steelblue;box-shadow: inset 1px 1px 11px 0px #00ffa5;
            padding: 2%;padding-top: 3%;padding-left: 4%;max-width:50em; color: cyan;line-height: 1.666em;"
            >-->
        <article class="mainTitle expanderROW">
            <span class="boxTitle" style="width:100%;">
                <span></span><span style="font-size:0.777em; color:cyan">2</span>
                MARGINZ</span>
            </span>
            <button class="expanderBTN" style="padding:0;font-size:0.777em;line-height: 1.444em;" 
                onclick="expander_BANKZ_Click(event)">✧</button>
        </article>
        <hr> 
        <article id="MARGINZ_RENDER_FRAME"></article>
        <hr> 
        <button id="detailsBtn1" class="blackBTN" onclick="setMarginDetailsClick(event)">details💎</button> 
    </section><!-- END BANKZ VIEW -->
    <!-- *********************************BOOKZ_-VIEW********************************-->
    <section id="BOOK_VIEW" style="border: solid 1px steelblue;justify-content: center; 
        flex-direction: column;border-radius: 13px;flex: 1;height: 10em;display: flex;
        padding: 1em 3% 2% 3%;max-width: 50em;margin: 0 10%;align-self: center;width: 88.888%;
        box-shadow:inset 1px 3px 13px 0px steelblue;"/>
        <!-- border:solid 1px steelblue;justify-content: center;flex-direction: column;
        border-radius: 13px;display:flex; padding:3%;flex:1;
        box-shadow:inset 1px 3px 13px 0px steelblue;max-width:50em;"> -->
        <article id="BOOKZ_RENDER_FRAME"></article>
        <hr> 
        <section id="BOOKFRAME_XMPL" class="BOOKFRAME_Item">
            <header class="mainTitle expanderROW">
                <span>XMPL</span>
                <span class="expanderBTN" style="font-size:0.777em;" onclick="expander_BOOKZ_Click(event)">✧</span>
            </header>
            <menu style="justify-content: space-evenly; border-radius: 13px; flex: 1 1 0%; display: flex; 
                margin-top: 0;padding: 0.222em 0px; width: 66.666%; align-self: center;">
                <span>
                    <div style="background:#26a69a;border-radius:100%;border:solid 1px steelblue;height:0.5em;width:0.5em;display: inline-block;
                    margin-right: 0.5em;"></div>
                    <span style="font-size:0.444em;">PRICE</span>
                </span>
                <span>
                    <div style="background:#2962ff;border-radius:100%;border:solid 1px steelblue;height:0.5em;width:0.5em;display: inline-block;
                    margin-right: 0.5em;"></div>
                    <span style="font-size:0.444em;">PROFITnLOSS</span>
                </span>
            </menu>
            <article id="candelstickFRAME_XMPL" style="justify-content:center;
                flex:1; display:flex;border:solid 1px steelblue;border-radius:22.222px;width:98%">
            </article>
            <section style="justify-content: center;margin-top:1em;flex-direction: column; padding:0 2% 0 2%;
            border-radius: 13px; flex:1; display:flex;border:solid 1px teal;width:90%;align-self:center;">
                <header class="expanderROW">
                    <span class="expanderTITLE">PnL:</span>
                    <span class="expanderBTN" onclick="MINMAX(event.target)">✧</span>
                </header>
                <article id="baselineFRAME_XMPL" style="justify-content: center;
                flex:1; display:flex;">
                </article>
                <header style="font-size: 0.888em;margin-bottom:1em;display:flex;justify-content: space-between; padding: 2em 3em 0 2em">
                    <span>
                        <div style="background:#26a69a;border-radius:100%;border:solid 1px steelblue;height:0.5em;width:0.5em;display: inline-block;
                        margin-right: 0.5em;"></div>                        
                        <span style="font-size:0.666em;margin-top: 0.333em;color:steelblue">PnL:</span>
                        <span style="font-size:0.666em;">234</span>
                    </span>
                    <span>
                        <div style="background:#26a69a;border-radius:100%;border:solid 1px steelblue;height:0.5em;width:0.5em;display: inline-block;
                        margin-right: 0.5em;"></div>
                        <span style="font-size:0.666em;">BOOK:</span>
                        <span style="font-size:0.666em;">1,234</span>
                    </span>
                    <span>
                        <div style="background:#26a69a;border-radius:100%;border:solid 1px steelblue;height:0.5em;width:0.5em;display: inline-block;
                        margin-right: 0.5em;"></div>
                        <span style="font-size:0.666em;">BANK:</span>
                        <span style="font-size:0.666em;">444</span>
                    </span>
                </header>                  
            </section>            
            <menu id="trend_FRAME_XMPL" class="FRAME" style="justify-content: center;
                border-radius: 13px; flex:1; display:flex; width:82.222%;margin: 0.666em auto;">
                <section id="trend_line_chart_xmpl"></section>
            </menu>
            <menu id="selectorFRAME_XMPL" class="FRAME" style="align-items: center;
                border-radius: 13px; flex:1; display:flex; width:82.222%;margin: 0.666em auto;">
                <select style="max-height:2em;margin: 0 1em;" class="chartSELECTOR"
                    onclick="getDataSelector(event.target)">
                    <option value="true" selected>2024_10_NVDA</option>
                    <option value="false">2023_11_AMZN</option>
                    <option value="false">2022_20_COIN</option>
                </select>
                <aside id="selectorVIEW_XMPL" style="border: solid 1px steelblue;border-radius: 13px;
                    padding: 1%;flex: 1"> </aside>
            </menu>
            <menu id="dataFRAME_XMPL" class="FRAME" style="justify-content: center;
                border-radius: 13px; flex:1; display:flex;flex-direction: column;">
                <header class="expanderROW">
                    <span class="expanderTITLE">METADATA:</span>
                    <span class="expanderBTN" onclick="MINMAX(event.target)">✴</span>
                </header>
                <section style="display:none;">...</section>
            </menu>
        </section><!--***********************************************end BOOKFRAME-->     
    </section><!--end BOOKVIEW-->

    <section id="DATA_VIEW" style="border:solid 1px steelblue;justify-content: center;flex-direction: column;
    border-radius: 13px; flex:1; height:10em; display:flex; padding:1em 3% 2% 3%;max-width:50em;margin:0 10%;
    box-shadow: 1px 3px 13px 0px steelblue;align-self:center; width:88.888%;" class="hiddenTab">
        <article id="DATA_MENU_FRAME">
            <menu style="display:flex;flex-wrap: wrap;font-size: 0.999em;padding-left:0; margin-top: 0.333em;
                justify-content: space-evenly;border-bottom: 1px dashed #021d33;padding-bottom: 0.666em;">
                <button id="GALLERY_VIEW_BTN" class="blackBTN" onclick="getDataGallery('gallery')">GALLERY</button>
                <button id="IMPORT_VIEW_BTN" class="blackBTN" onclick="getDataGallery('import')">IMPORT</button>
            </menu>
            <main id="data_gallery_list"></main>
        </article>        

        <article id="DATA_GALLERY_FRAME"  style="height:35em; border:solid 1px steelblue;border-radius:10px;
        background: black; border: solid 1px lime;display: flex;flex-direction: column;align-items: center;" class="hiddenTab">
            <header style="margin:1em;width: 100%;padding-left:2em;">TICKER DATA</header>
            <section id="render_TICKR_GALLERY" style="width: 88.888%;"></section>
        </article> 
        <article id="DATA_IMPORT_FRAME" style="height:35em; border:solid 1px steelblue;border-radius:10px;
                background: black; border: solid 1px lime;display: flex;flex-direction: column;align-items: center;" class="hiddenTab">
            <header style="margin:1em;width: 100%;padding-left:2em;">IMPORT TRADE DATA</header>
            <textarea id="render_TRADE_IMPORT" class="scrollBarV txtSizer" style="overflow-x:visible;flex:1 1 0;resize:horizontal;background: black;color: lime;
                width:80.888%;padding:2em;border-radius: 13px;box-shadow: 0px 0px 8px purple;">
            [{"tkr":"BTC","type":"BUY","mode":"Limit","ymd":"2020_4_3","ymtID":"2020_4_BTC",
                "amt":"111","shares":"0.0017","price":"64,428.71","role":""},
            {"tkr":"BTC","type":"BUY","mode":"Market","ymd":"2020_4_3","ymtID":"2020_4_BTC",
                "amt":"22","shares":"0.0003","price":"66,402.48","role":""},
            {"tkr":"BTC","type":"BUY","mode":"Market","ymd":"2020_4_3","ymtID":"2020_4_BTC",
                "amt":"44","shares":"0.0007","price":"66,058.39","role":""}]</textarea> 
            <footer class="main_footer">
                <button class="BTN" style="font-size:1em;margin:1em;" onclick="import_TradeClick()">IMPORT TRADE DATA</button>
            </footer>               
        </article>        

        <article id="DATA_TICKR_FRAME" style="height:35em; border:solid 1px steelblue;border-radius:10px;
        background: black; border: solid 1px lime;display: flex;flex-direction: column;align-items: center;" class="hiddenTab">
            <header style="margin:1em;width: 100%;padding-left:2em;">OVERWRITE TICKER DATA</header>
            <textarea id="render_TICKR_DATA" class="scrollBarV txtSizer"style="overflow-x:visible;flex: 1 1 0;resize:horizontal;background:black;
               color: lime;
                width:80.888%;padding: 4%;border-radius: 13px;box-shadow: 0px 0px 8px purple;margin-bottom: 1em;" >
            [{"tkr":"BTC","type":"BUY","mode":"Limit","ymd":"2020_4_3","ymtID":"2020_4_BTC",
                "amt":"111","shares":"0.0017","price":"64,428.71","role":""},
            {"tkr":"BTC","type":"BUY","mode":"Market","ymd":"2020_4_3","ymtID":"2020_4_BTC",
                "amt":"22","shares":"0.0003","price":"66,402.48","role":""},
            {"tkr":"BTC","type":"BUY","mode":"Market","ymd":"2020_4_3","ymtID":"2020_4_BTC",
                "amt":"44","shares":"0.0007","price":"66,058.39","role":""}]</textarea> 
            <footer class="main_footer" style="display:flex;width: 100%;height:2.222em;justify-content:space-around;
                align-items:center;margin-bottom: 1em;">
                <!-- <select id="tickr_SELECTOR_YMT" class="chartSELECTOR">
                    <option value="true" selected>...</option>
                </select> -->
                <button class="BTN" style="font-size:1em;margin:1em;" onclick="save_TickerClick()">OVERWRITE TKR MONTH</button>
            </footer>   
        </article>        
        <article id="DATA_TRADE_FRAME" style="height:35em; border:solid 1px steelblue;border-radius:10px;
        background: black; border: solid 1px lime;display: flex;flex-direction: column;align-items: center;" class="hiddenTab">
            <header style="margin:1em;width: 100%;padding-left:2em;">OVERWRITE TRADE DATA</header>
            <textarea id="render_TRADE_DATA" class="scrollBarV txtSizer" style="overflow-x: visible;flex: 1 1 0;resize:horizontal;background: black;color: lime;
                width:80.888%;padding: 4%;border-radius: 13px;box-shadow: 0px 0px 8px purple;">
            [{"tkr":"BTC","type":"BUY","mode":"Limit","ymd":"2020_4_3","ymtID":"2020_4_BTC",
                "amt":"111","shares":"0.0017","price":"64,428.71","role":""},
            {"tkr":"BTC","type":"BUY","mode":"Market","ymd":"2020_4_3","ymtID":"2020_4_BTC",
                "amt":"22","shares":"0.0003","price":"66,402.48","role":""},
            {"tkr":"BTC","type":"BUY","mode":"Market","ymd":"2020_4_3","ymtID":"2020_4_BTC",
                "amt":"44","shares":"0.0007","price":"66,058.39","role":""}]</textarea> 
            <footer class="main_footer" style="display:flex;width: 100%;height:2.222em;justify-content:space-around;
                align-items:center;margin:1em 0;">
                <!-- <select id="trade_SELECTOR_YMT" class="chartSELECTOR">
                    <option value="true" selected>...</option>
                </select> -->
                <button class="BTN" style="font-size:1em;" onclick="save_TradeClick()">OVERWRITE MONTH TRADES</button>
            </footer>   
        </article>        
    </section><!--end DATAVIEW-->
<script  >// *************LOCAL_DB*********************
/*************************************************************\
 * bankbookz_DB - ability to save monthly data in localstorage
\*************************************************************/
let bankbookz_DB=null;
const bankbookz_DB_LOAD_MOCK_DATA=()=>{ //INIT DATA_MODEL XMPL
    bankbookz_DB = { 
            TRADE_TXNZ_YMT:{//default_BTC_TRADEZ,
        
            "2020_1_ETH":[ //Monthly trade data
                {"tkr":"ETH","type":"SELL","mode":"Limit","ymd":"2020_4_3","ymtID":"2020_4_ETH",
                    "amt":"111","shares":"0.0017","price":"64,428.71","role":""},
                {"tkr":"ETH","type":"BUY","mode":"Limit","ymd":"2020_4_3","ymtID":"2020_4_ETH",
                    "amt":"111","shares":"0.0017","price":"64,428.71","role":""},
            ],
            "2020_1_BTC":[ //Monthly trade data
                {"tkr":"BTC","type":"SELL","mode":"Limit","ymd":"2020_4_3","ymtID":"2020_4_BTC",
                    "amt":"111","shares":"0.0017","price":"64,428.71","role":""},
                {"tkr":"BTC","type":"BUY","mode":"Limit","ymd":"2020_4_3","ymtID":"2020_4_BTC",
                    "amt":"111","shares":"0.0017","price":"64,428.71","role":""},
            ],
            "2024_7_BTC":[ //Monthly trade data
                {"tkr":"BTC","type":"SELL","mode":"Limit","ymd":"2024_7_4","ymtID":"2024_7_BTC",
                    "amt":"111","shares":"0.0017","price":"64,428.71","role":""},
                {"tkr":"BTC","type":"BUY","mode":"Limit","ymd":"2024_7_6","ymtID":"2024_7_BTC",
                    "amt":"111","shares":"0.0014","price":"64,444.44","role":""},
            ],
        },
        // TICKR_DATA_MAP_Monthly:{
        //     "BTC":{"2024_07_BTC":[]},
        //     "ETH":{"2024_07_ETH":[]},
        // },
        TICKR_DATA_MAP_Monthly : default_TICKR_DATA_MAP_Monthly,
        TICKR_LIST:[//{name:'XMPL',lastLoadYMD:''},
            {tkr:'BTC',lastLoadYMD:''},{tkr:'ETH',lastLoadYMD:''}
        ],
        METASTATE:{ 
            BOOKZ_EXPANDER:['BTC'], //multiple expansion.
            lastRefreshMap:{'BTC':'2020-10-11 00:00:00'},
            monthlySELECTORMap:{'BTC':'All Time'}
        } 
    }
    save_BANKBOOKZ_DB();
}
const bankbookz_DB_init=()=>{ //READ from LOCAL STORAGE
    try{
        bankbookz_DB = (localStorage.bankbookz_DB)?
        JSON.parse( localStorage.bankbookz_DB ):null;
        // bankbookz_DB = null; //DEV: load mock data for TEST
        if(!bankbookz_DB){ bankbookz_DB_LOAD_MOCK_DATA(); }
    } catch(e){ bankbookz_DB_LOAD_MOCK_DATA(); }
}; bankbookz_DB_init();
function save_BANKBOOKZ_DB(){ //singleton, save LocalDB;.
    // console.log('SAVED BANKBOOKZ DB.')
    // localStorage.bankbookz_DB = JSON.stringify(bankbookz_DB); //SAVE to LOCAL STORAGE 
}
</script><!--***********************END LOCAL DB*********************-->
<script  >// *************APP UTILITIES*********************
//*************************************************CUSTOM MINMAX***********
function MINMAX(TGT, setState){ //setState optional to force expand or collapse, otherwise toggle.
    const CURR_STATE = TGT.innerHTML; //get parent and hide/show everything but expanderROW
    const ROW = TGT.parentElement; //required
    if(ROW.classList.contains("expanderROW")){ //if row hide siblings.
        let aSibling = ROW.nextElementSibling;
        while (aSibling) { //loop next siblings
            if(CURR_STATE==='✴'||setState){ //COLLAPSE
                aSibling.style.display = 'flex'; //required
            } else { aSibling.style.display = 'none'; 
            }//EXPAND (default)
            aSibling = aSibling.nextElementSibling;
        }
        TGT.innerHTML = (CURR_STATE==='✴'||setState) ? '✧' : '✴';
    }
}
//*************************************************END MINMAX***********
// function order_YMD_KEYS(ymdSet) {
//   return ymdSet.sort((a, b) => {
//     const aParts = a.split('_');
//     const bParts = b.split('_');
//     return parseInt(aParts[1]) - parseInt(bParts[1]);
//   });
// }
function order_YMD_KEYS(ymdSet) {
  return ymdSet.sort((a, b) => {
    const aParts = a.split('_');
    const bParts = b.split('_');

    // Compare years first
    if (aParts[0] !== bParts[0]) {
      return parseInt(aParts[0]) - parseInt(bParts[0]);
    }

    // If years are equal, compare months
    return parseInt(aParts[1]) - parseInt(bParts[1]);
  });
}
//---*************CUSTOM CHART_SELECTOR------------------
function getDataSelector(e){
    let TGT = e.target;
    const selectedIndex = TGT.selectedIndex;
    if (selectedIndex !== -1) {
        const selectedOption = TGT.options[selectedIndex];
        console.log("Selected value:", selectedOption.value);
        console.log("Selected text:", selectedOption.text);
    } else {
        console.log("No option selected.");
    }
}
</script><!--***********END APP UTILITIES *********************-->
<script  >// ********************MAIN DYNAMIC CHART**********************
let DYNA_CHART_CANDLES = []; //for screen resize
let Dyna_Chart_CandleStick; //for modular tools. //TODO. candlesticks[]
function init_DYNA_CHART_Candle(tgtELEM){
    const chartOptions = {width:400,height:300,
        layout:{textColor:'steelblue',
            fontSize:10,
            fontFamily:'sans-serif',//'Roboto',
            // fontBoldWeight: 800,
            background:{type:'solid',color:'#000000'} },
        grid: { vertLines: { color: "#222" }, horzLines: { color: "#282828" } },
        crosshair:{mode:LightweightCharts.CrosshairMode.Normal,vertLine:{color:"darkslategrey"},horzLine:{color:"darkslategrey"} },
        rightPriceScale:{visible:true,},leftPriceScale:{visible:true},
    }
    let tgtTKR = tgtELEM.id.split('_')[1]; 
    tgtELEM.innerHTML=''; //blank out
    // const Dyna_Chart_CandleStick = 
    Dyna_Chart_CandleStick = LightweightCharts.createChart(tgtELEM, chartOptions);
    // window.Dyna_CandleStick = Dyna_Chart_CandleStick;
    //AREA-SERIES******************************************************
    // const areaSeries = Dyna_Chart_CandleStick.addAreaSeries({
    //     lineColor:'#2962FF',topColor:'#2962FF',bottomColor:'rgba(41, 98, 255, 0.28)',layout:{ textColor: 'steelblue', 
    //     background: { type: 'solid', color: '#000000' } }, pointMarkersVisible:true, pointMarkersRadius:4
    // });
    // let areaSeriesDATA = getArea_TRADE_DATA(tgtTKR);
    // areaSeries.setData(areaSeriesDATA);
    //END: AREA-SERIES******************************************************        
    // CANDLESTICK-SERIES******************************************************        
    const candlestickSeries = Dyna_Chart_CandleStick.addCandlestickSeries({
        priceScaleId: 'left', layout: {textColor:'steelblue',background: { type: 'solid', color: '#000000' } },
        wickUpColor: "#26a69a",upColor: "#26a69a",wickDownColor: "rgb(225, 50, 85)",downColor: "rgb(225, 50, 85)",
    });
    let candleSeriesDATA = getCandleSeriesDATA(tgtTKR);
    candlestickSeries.setData(candleSeriesDATA);
    let tradeMarkerData = getMarker_TRADE_DATA(tgtTKR);
    candlestickSeries.setMarkers(tradeMarkerData);
    Dyna_Chart_CandleStick.timeScale().fitContent();    
    resize_DYNA_CHART_Candle(Dyna_Chart_CandleStick);
    DYNA_CHART_CANDLES.push(Dyna_Chart_CandleStick); //for screen resize
}; //END INIT DYNA_CHART - candle *****************************************
function resize_DYNA_CHART_Candle(elem){
    let frame = document.getElementById('BOOK_VIEW');
    let maxWidth = (frame.offsetWidth>800)?700:(frame.offsetWidth<400)?frame.offsetWidth-40:frame.offsetWidth-80;//(frame.offsetWidth*0.1);
    let maxHeight = (frame.offsetWidth>800)?600:frame.offsetWidth-200;
    if(maxWidth<100 || maxHeight<50){return}
    elem.resize(maxWidth, maxHeight);
}
function init_DYNA_SELECTOR(tkr){ //Put all the months in the combo list.
    let selectELEM = document.getElementById('DYNA_YMT_SELECTOR_'+tkr)
    if(!selectELEM){debugger;}
    selectELEM.innerHTML = '';
    // selectElement.multiple = true;
    selectELEM.addEventListener("change", (event) => {DYNA_SELECTOR_Change(event)}); 
    const option1 = document.createElement("option");
    option1.text = "Last 30";
    option1.value = "Last 30"; 
    selectELEM.appendChild(option1);
    const option2 = document.createElement("option");
    option2.text = "All Time";
    option2.value = "All Time"; 
    selectELEM.appendChild(option2);
    let optionKEYS = Object.keys(bankbookz_DB.TICKR_DATA_MAP_Monthly[tkr]);
    let dynaOption;
    for(ymd of optionKEYS){
        dynaOption = document.createElement("option");
        dynaOption.text = ymd;
        dynaOption.value = ymd; 
        selectELEM.appendChild(dynaOption);
    }
    if(!bankbookz_DB.METASTATE.monthlySELECTORMap[tkr]){ //save selection
        bankbookz_DB.METASTATE.monthlySELECTORMap[tkr] = 'Last 30'; //default 
    }
    selectELEM.value = bankbookz_DB.METASTATE.monthlySELECTORMap[tkr]
    //SET TEXT SELECTOR TITLES
    const all_TITLES_TXT = document.getElementById(`candlestickTITLES_${tkr}`);
    all_TITLES_TXT.innerText = bankbookz_DB.METASTATE.monthlySELECTORMap[tkr]
}
function DYNA_SELECTOR_Change(e){

    let TGTymt = e.target.value;
    let TGTID = e.target.id;
    let TGTtkr = TGTID.split("_")[3]
    bankbookz_DB.METASTATE.monthlySELECTORMap[TGTtkr] = TGTymt;
    save_BANKBOOKZ_DB();
    
    //GET RELATIVE CHART
    // let chartELEM = e.target.parentElement.parentElement.nextElementSibling;
    let chartELEM = e.target.parentElement.parentElement.previousSibling.previousSibling;
    init_DYNA_CHART_Candle(chartELEM);
    
    // debugger;
    // DYNAMIC SELECTOR BEHAVIOR:
    // - IF CURRENT_TGT exists in CURRENT selectionLIST, then REMOVE, else ADD.
    const all_TITLES_TXT = document.getElementById(`candlestickTITLES_${TGTtkr}`);
    if(TGTymt==='Last 30' || TGTymt==='All Time'){
        all_TITLES_TXT.innerText = `${TGTymt} - ${TGTtkr}`;
        return;
    }    
    const currentSELECTORZ = all_TITLES_TXT.innerText.split(', ');
    const newSELECTORZ = [TGTymt];//,foundSelector=false;;
    for(var f=0;f<currentSELECTORZ.length;f++){
        if(currentSELECTORZ[f].indexOf('Last 30')>-1 ||
        currentSELECTORZ[f].indexOf('All Time')>-1){
            break;
        }
        if(currentSELECTORZ[f]===TGTymt){//remove
            newSELECTORZ.shift();//remove first
            continue;
        }else if(currentSELECTORZ[f].indexOf('_')>-1){
            newSELECTORZ.push(currentSELECTORZ[f])
        }
    }
    if(!newSELECTORZ.length){
        all_TITLES_TXT.innerText = `Last 30 - ${TGTtkr}`;
    }else{
        all_TITLES_TXT.innerText = newSELECTORZ.join(', ')
    }
    //USE CASES:
    //1. 'loading' - falls through only renders selection
    //2. 'Last 30' & 'All Time' - only renders selection.
    //3. New _ - add to newselectorz and join.
    //4. OLD _ - remove from newselectors and join.
}
//*************************************************END DYNA CHART CHART***********

//******DYNA CHART - BASELINE*****************************************
let DYNA_CHART_BASELINES = []; //for screen resize
function init_DYNA_CHART_Baseline(tgtELEM){
    const chartOptions = { width:300,height:100,
        layout: { textColor: 'white', background: { type: 'solid', color: 'black' } },
        grid: { vertLines: { color: "#222" }, horzLines: { color: "#282828" } }, 
    };
    tgtELEM.innerHTML='';
    let Dyna_Chart_Baseline = LightweightCharts.createChart(tgtELEM, chartOptions);
    const baselineSeries = Dyna_Chart_Baseline.addBaselineSeries({ baseValue: { type: 'price', price: 25 }, topLineColor: 'rgba( 38, 166, 154, 1)', topFillColor1: 'rgba( 38, 166, 154, 0.28)', topFillColor2: 'rgba( 38, 166, 154, 0.05)', bottomLineColor: 'rgba( 239, 83, 80, 1)', bottomFillColor1: 'rgba( 239, 83, 80, 0.05)', bottomFillColor2: 'rgba( 239, 83, 80, 0.28)' });
    const data = [{ value: 1, time: 1642425322 }, { value: 8, time: 1642511722 }, { value: 10, time: 1642598122 }, { value: 20, time: 1642684522 }, { value: 3, time: 1642770922 }, { value: 43, time: 1642857322 }, { value: 41, time: 1642943722 }, { value: 43, time: 1643030122 }, { value: 56, time: 1643116522 }, { value: 46, time: 1643202922 }];
    baselineSeries.setData(data);
    Dyna_Chart_Baseline.timeScale().fitContent();
    resize_DYNA_CHART_Baseline(Dyna_Chart_Baseline);
    DYNA_CHART_BASELINES.push(Dyna_Chart_Baseline); //for screen resize    
}; //END INIT DYNA_CHART - baseline
function resize_DYNA_CHART_Baseline(elem){
    let frame = document.getElementsByClassName('dynamicBaseline')[0]
    let maxWidth = (frame.offsetWidth>700)?700:(frame.offsetWidth<700)?frame.offsetWidth-40:frame.offsetWidth-60;//(frame.offsetWidth*0.1);
    let maxHeight = 100;//(frame.offsetWidth>800)?600:frame.offsetWidth-200;  
    if(maxWidth<100){return}
    elem.resize(maxWidth, maxHeight);
}; 
//*************************************************END DYNA-CHART BASELINE***********
//******************************SCREEN RESIZE - DYNA CHART***********
window.addEventListener('resize', () => { //for SCREEN RESIZE - CANDLE CHARTS
    for(var j=0; j<DYNA_CHART_CANDLES.length;j++){
        tgtTKR = DYNA_CHART_CANDLES[j];
        resize_DYNA_CHART_Candle(tgtTKR)
    }  
    for(var j=0; j<DYNA_CHART_BASELINES.length;j++){
        tgtTKR = DYNA_CHART_BASELINES[j];
        resize_DYNA_CHART_Baseline(tgtTKR)
    }  
});
//******************************SCREEN RESIZE - DYNA CHART***********
//*******GET DATA for - DYNA CHART***********
function getMarker_TRADE_DATA(aTKR){
    let tradeMarkerData = [];
        // debugger;
        let monthlySELECTOR = bankbookz_DB.METASTATE.monthlySELECTORMap[aTKR];
        if(!monthlySELECTOR && aTKR){
            monthlySELECTOR = 'Last 30'; //DEFAULT
            bankbookz_DB.METASTATE.monthlySELECTORMap[aTKR]=monthlySELECTOR;
        }
        if(monthlySELECTOR==='Last 30'){ //LAST 30 days of tickrs
            let ymtKEYS = Object.keys(bankbookz_DB.TRADE_TXNZ_YMT);
            let tradeSET=[],markerOBJ={},monthKEY,displayVal;
            let dayCNT = 0,tkrTAG,txnObj;
            ymtKEYS = order_YMD_KEYS(ymtKEYS);
            // debugger;
            // // const ymdSet = ["2024_3_A", "2024_1_A", "2024_02_A"];
            // const ymdSet =  ["2024_03_A", "2024_1_A", "2024_02_A", "2023_1_A", "2022_2_A"];
            // const result_array = order_YMD_KEYS(ymdSet);
            // console.log(result_array);


            ymtKEYS.reverse(); //oldest first.
            for(var i = 0; i< ymtKEYS.length && dayCNT<31; i++){ //last 30 days
                monthKEY = ymtKEYS[i];
                tkrTAG = monthKEY.split("_")[2]
                if(tkrTAG!=aTKR){continue}
                tradeSET = bankbookz_DB.TRADE_TXNZ_YMT[monthKEY]
                for(var ii=0; ii<tradeSET.length;ii++){
                    dayCNT++;
                    if(dayCNT>30){break;}
                    markerOBJ={};
                    markerOBJ.time = tradeSET[ii].ymd.replace(/_/g,'-'); //for charts.
                    markerOBJ.value = parseFloat(tradeSET[ii].price.replace(/,/g,'') );
                    markerOBJ.position = (tradeSET[ii].type==='BUY')?"aboveBar":"belowBar";
                    markerOBJ.color = (tradeSET[ii].type==='BUY')?"#219644":"#e91e63";
                    displayVal = Math.trunc(markerOBJ.value)
                    markerOBJ.text = `${displayVal}`;
                    markerOBJ.shape = "circle";
                    markerOBJ.size = 0.444;
                    tradeMarkerData.push(markerOBJ);
                }
            }  
            return tradeMarkerData
        }
        // else if (monthlySELECTOR==='All Time') { //load all data for tkrs.
        //     tradeMarkerData = [
        //     { time: '2024-7-2', value: 66232.51 },{ time: '2024-7-3', value: 65331.11 },
        //     { time: '2024-7-4', value: 64227.02 },{ time: '2024-7-5', value: 64327.32 },
        //     { time: '2024-7-6', value: 65225.17 },{ time: '2024-7-7', value: 64328.89 },
        //     { time: '2024-7-8', value: 65225.46 },{ time: '2024-7-9', value: 66323.92 },
        //     { time: '2024-7-10', value: 67222.68 },{ time: '2024-7-11', value: 68322.67 },
        // ]             
        // }else {
        //     tradeMarkerData = [
        //     { time: '2024-7-2', value: 66232.51 },{ time: '2024-7-3', value: 65331.11 },
        //     { time: '2024-7-4', value: 64227.02 },{ time: '2024-7-5', value: 64327.32 },
        //     { time: '2024-7-6', value: 65225.17 },{ time: '2024-7-7', value: 64328.89 },
        //     { time: '2024-7-8', value: 65225.46 },{ time: '2024-7-9', value: 66323.92 },
        //     { time: '2024-7-10', value: 67222.68 },{ time: '2024-7-11', value: 68322.67 },
        // ]        
        // } 
        
        tradeMarkerData = [
            {"time":'2024-7-1',"position":"aboveBar","color":"#ff8400","shape":"circle","text":"D","size":4},
            {"time":'2024-7-4',"position":"belowBar","color":"#e91e63","shape":"arrowUp","text":"Buy @ 42"},
            {"time":'2024-7-6',"position":"belowBar","color":"#e91e63","shape":"circle","text":"Buy @ 44",size:4},
            {"time":'2024-7-8',"position":"aboveBar","color":"#219644","shape":"arrowDown","text":"Sell @ 75"},
            {"time":'2024-7-14',"position":"aboveBar","color":"#219644","shape":"arrowDown","text":"Sell @ 77"}
        ];        

        return tradeMarkerData;
}
function getArea_TRADE_DATA(aTKR){
    let areaSeriesDATA = [];
    let monthlySELECTOR = bankbookz_DB.METASTATE.monthlySELECTORMap[aTKR];
    if(!monthlySELECTOR && aTKR){
        monthlySELECTOR = 'Last 30';
        bankbookz_DB.METASTATE.monthlySELECTORMap[aTKR]=monthlySELECTOR;
    }
    if(monthlySELECTOR==='Last 30'){ //LAST 30 days of tickrs
        let ymtKEYS = Object.keys(bankbookz_DB.TRADE_TXNZ_YMT);
        let tradeSET=[],monthKEY;
        let dayCNT = 0,tkrTAG,txnObj;
        ymtKEYS.reverse(); //oldest first.
        for(var i = 0; i< ymtKEYS.length && dayCNT<31; i++){ //last 30 days
            monthKEY = ymtKEYS[i];
            tkrTAG = monthKEY.split("_")[2]
            if(tkrTAG!=aTKR){continue}
            tradeSET = bankbookz_DB.TRADE_TXNZ_YMT[monthKEY]
            for(var ii=0; ii<tradeSET.length;ii++){
                dayCNT++;
                if(dayCNT>30){break;}
                tradeSET[ii].time = tradeSET[ii].ymd.replace(/_/g,'-'); //for charts.
                tradeSET[ii].value = parseFloat(tradeSET[ii].price.replace(/,/g,'') );
                areaSeriesDATA.push(tradeSET[ii]);
            }
        }  
    }else if (monthlySELECTOR==='All Time') { //load all data for tkrs.
        areaSeriesDATA = [
        { time: '2024-7-2', value: 66232.51 },{ time: '2024-7-3', value: 65331.11 },
        { time: '2024-7-4', value: 64227.02 },{ time: '2024-7-5', value: 64327.32 },
        { time: '2024-7-6', value: 65225.17 },{ time: '2024-7-7', value: 64328.89 },
        { time: '2024-7-8', value: 65225.46 },{ time: '2024-7-9', value: 66323.92 },
        { time: '2024-7-10', value: 67222.68 },{ time: '2024-7-11', value: 68322.67 },
    ]        
        // let ymtKEYS = Object.keys(bankbookz_DB.TRADE_TXNZ_YMT);
        // let txnSET=[],monthKEY,txnItem;
        // for(var i = 0; i< ymtKEYS.length; i++){ //all time
        //     monthKEY = ymtKEYS[i];
        //     tkrTAG = monthKEY.split("_")[2]
        //     if(tkrTAG!=aTKR){continue}
        //     txnSET = bankbookz_DB.TRADE_TXNZ_YMT[monthKEY]
        //     for(var ii=0; ii<txnSET.length;ii++){
        //         areaSeriesDATA.push(txnSET[ii]);
        //     }
        // }  
        // areaSeriesDATA.reverse();        
    }else {
        areaSeriesDATA = [
        { time: '2024-7-2', value: 66232.51 },{ time: '2024-7-3', value: 65331.11 },
        { time: '2024-7-4', value: 64227.02 },{ time: '2024-7-5', value: 64327.32 },
        { time: '2024-7-6', value: 65225.17 },{ time: '2024-7-7', value: 64328.89 },
        { time: '2024-7-8', value: 65225.46 },{ time: '2024-7-9', value: 66323.92 },
        { time: '2024-7-10', value: 67222.68 },{ time: '2024-7-11', value: 68322.67 },
    ]        
        // console.log('SELECTED',monthlySELECTOR)
        // areaSeriesDATA.push(...bankbookz_DB.TRADE_TXNZ_YMT[monthlySELECTOR]);
        // areaSeriesDATA.reverse(); 
    }
    // return areaSeriesDATA;    
//     let areaSeriesDATA = [];
//     let ymtKeys = Object.keys( bankbookz_DB.TRADE_TXNZ_YMT );
//     let tradeSET,tradeItem,ymt_id,tkrTAG, selector;
//     debugger;
//     for(var i=0; i< ymtKeys.length;i++){
//         ymt_id = ymtKeys[i];
//         tkrTAG = ymt_id.split("_")[2]
//         selector = bankbookz_DB.METASTATE.monthlySELECTORMap[tkrTAG]
//         if(tkrTAG!=aTKR){continue}
//         if(selector==='Last 30'){
//             debugger;
//         }else if(selector==='All Time'){
//             debugger;
//         }else if(selector) {
//             debugger;
//         }
        
//     }
// debugger;


    // let ymtKEYS = Object.keys(bankbookz_DB.TICKR_DATA_MAP_Monthly[aTKR]);
    //     let txnSET=[],monthKEY,txnItem;
    //     for(var i = 0; i< ymtKEYS.length; i++){ //last 30 days
    //         monthKEY = ymtKEYS[i];
    //         txnSET = bankbookz_DB.TICKR_DATA_MAP_Monthly[aTKR][monthKEY]
    //         for(var ii=0; ii<txnSET.length;ii++){
    //             candleSeriesDATA.push(txnSET[ii]);
    //         }
    //     } 


    // let monthKEYS = Object.keys(bankbookz_DB.TRADE_TXNZ_YMT);
    // let dataSTR = '',txnSET,txnItem,tkrTAG='';
    // render_TRADE_DATA.innerHTML=''; //blank out
    // for(var i=0; i<monthKEYS.length;i++){
    //     moKEY = monthKEYS[i];
    //     tkrTAG = moKEY.split("_")[2]
    //     if(tkrTAG!=datatgt){continue}
    //     txnSET = bankbookz_DB.TRADE_TXNZ_YMT[moKEY];
    //     dataSTR += `# Month:${moKEY} --->\n`;
    //     for(var ii=0; ii< txnSET.length;ii++){
    //         txnItem = txnSET[ii]
    //         itemSTR = JSON.stringify(txnItem)+'\n';
    //         dataSTR += itemSTR;
    //     }
    //     dataSTR += `# -----END-MONTH------->\n\n`;        
    // }  


    return areaSeriesDATA;    
}
function getCandleSeriesDATA(aTKR){
    let candleSeriesDATA = [];
    let monthlySELECTOR = bankbookz_DB.METASTATE.monthlySELECTORMap[aTKR];
    if(!monthlySELECTOR && aTKR){
        monthlySELECTOR = 'Last 30';
        bankbookz_DB.METASTATE.monthlySELECTORMap[aTKR]=monthlySELECTOR;
    }
    if(monthlySELECTOR==='Last 30'){ //LAST 30 days of tickrs
        let ymtKEYS = Object.keys(bankbookz_DB.TICKR_DATA_MAP_Monthly[aTKR]);
        let txnSET=[],monthKEY,txnItem;
        let dayCNT = 0;
        for(var i = 0; i< ymtKEYS.length && dayCNT<31; i++){ //last 30 days
            monthKEY = ymtKEYS[i];
            txnSET = bankbookz_DB.TICKR_DATA_MAP_Monthly[aTKR][monthKEY]
            for(var ii=0; ii<txnSET.length;ii++){
                dayCNT++;
                if(dayCNT>30){break;}
                candleSeriesDATA.push(txnSET[ii]);
            }
        }  
        candleSeriesDATA.reverse();
    }else if (monthlySELECTOR==='All Time') { //load all data for tkrs.
        let ymtKEYS = Object.keys(bankbookz_DB.TICKR_DATA_MAP_Monthly[aTKR]);
        let txnSET=[],monthKEY,txnItem;
        for(var i = 0; i< ymtKEYS.length; i++){ //last 30 days
            monthKEY = ymtKEYS[i];
            txnSET = bankbookz_DB.TICKR_DATA_MAP_Monthly[aTKR][monthKEY]
            for(var ii=0; ii<txnSET.length;ii++){
                candleSeriesDATA.push(txnSET[ii]);
            }
        }  
        candleSeriesDATA.reverse();        
    }else {
        console.log('SELECTED',monthlySELECTOR)
        candleSeriesDATA.push(...bankbookz_DB.TICKR_DATA_MAP_Monthly[aTKR][monthlySELECTOR]);
        candleSeriesDATA.reverse(); 
    }
    return candleSeriesDATA;
}
//*******END GET DATA for - DYNA CHART***********

</script><!--****************************END DYNAMIC CHART-->
<script  >// ****************************** XMPL CHART**********************
let CandlestickChart1;
function initCandleChart_XMPL(){
    const chartOptions = { width: 400, height: 300, 
        layout: { textColor: 'steelblue', background: { type: 'solid', color: '#000000' } },
        grid: { vertLines: { color: "#222" }, horzLines: { color: "#9090ff" } },
        crosshair: { mode: LightweightCharts.CrosshairMode.Normal ,
            vertLine: { color: "darkslategrey" },
            horzLine: { color: "darkslategrey" },
        },
        rightPriceScale:{visible:true,},leftPriceScale:{visible:true},
    }
    CandlestickChart1 = LightweightCharts.createChart(
        document.getElementById('candelstickFRAME_XMPL'), chartOptions);
    //AREA-SERIES******************************************************
    const areaSeries = CandlestickChart1.addAreaSeries({
        lineColor: '#2962FF', topColor: '#2962FF',
        bottomColor: 'rgba(41, 98, 255, 0.28)',layout: { textColor: 'steelblue', 
        background: { type: 'solid', color: '#000000' } } ,
        pointMarkersVisible:true, pointMarkersRadius:4
    });
    areaSeries.setData([
        { time: '2018-12-22', value: 232.51 },{ time: '2018-12-23', value: 331.11 },
        { time: '2018-12-24', value: 227.02 },{ time: '2018-12-25', value: 327.32 },
        { time: '2018-12-26', value: 225.17 },{ time: '2018-12-27', value: 328.89 },
        { time: '2018-12-28', value: 225.46 },{ time: '2018-12-29', value: 323.92 },
        { time: '2018-12-30', value: 222.68 },{ time: '2018-12-31', value: 322.67 },
    ]);
    //END: AREA-SERIES******************************************************        
    // CANDLESTICK-SERIES******************************************************        
    const candlestickSeries = CandlestickChart1.addCandlestickSeries({
        priceScaleId: 'left',
        layout: { textColor: 'steelblue', 
        background: { type: 'solid', color: '#000000' } }  ,
        wickUpColor: "#26a69a",
        upColor: "#26a69a",
        wickDownColor: "rgb(225, 50, 85)",
        downColor: "rgb(225, 50, 85)",
    });
    candlestickSeries.setData([
        {time: '2018-12-22', open: 7511.16, high: 8211.84, low: 3611.16, close: 4511.72 },{time: '2018-12-23', open: 4511.12, high: 5311.90, low: 4511.12, close: 4811.09 },
        {time: '2018-12-24', open: 6011.71, high: 6011.71, low: 5311.39, close: 5911.29 },{time: '2018-12-25', open: 6811.26, high: 6811.26, low: 5911.04, close: 6011.50 },
        {time: '2018-12-26', open: 6711.71, high: 10511.85, low: 6611.67, close: 9111.04 },{time: '2018-12-27', open: 9111.04, high: 12111.40, low: 8211.70, close: 11111.40 },
        {time: '2018-12-28', open: 11111.51, high: 14211.83, low: 10311.34, close: 13111.25 },{time: '2018-12-29', open: 13111.33, high: 15111.17, low: 7711.68, close: 9611.43 },
        {time: '2018-12-30', open: 10611.33, high: 11011.20, low: 9011.39, close: 9811.10 },{time: '2018-12-31', open: 10911.87, high: 11411.69, low: 8511.66, close: 11111.26 },
    ]);
    CandlestickChart1.timeScale().fitContent();    
    resizeCandlestickChart1();
}; initCandleChart_XMPL();

function resizeCandlestickChart1(){
    let frame = document.getElementById('BOOK_VIEW');
    let maxWidth = (frame.offsetWidth>800)?700:(frame.offsetWidth<400)?frame.offsetWidth-40:frame.offsetWidth-80;//(frame.offsetWidth*0.1);
    let maxHeight = (frame.offsetWidth>800)?600:frame.offsetWidth-200;
    if(maxWidth<100 || maxHeight<50){return}
    CandlestickChart1.resize(maxWidth, maxHeight);
}
//*************************************************MAIN BASELINE CHART***********
let BaselineChart_XMPL;
function initBaselineChart_XMPL(){
    const chartOptions = { 
        layout: { textColor: 'white', background: { type: 'solid', color: 'black' } },
        grid: { vertLines: { color: "#222" }, horzLines: { color: "#282828" } }, 
    };
    BaselineChart_XMPL = LightweightCharts.createChart(document.getElementById('baselineFRAME_XMPL'), chartOptions);
    const baselineSeries = BaselineChart_XMPL.addBaselineSeries({ baseValue: { type: 'price', price: 25 }, topLineColor: 'rgba( 38, 166, 154, 1)', topFillColor1: 'rgba( 38, 166, 154, 0.28)', topFillColor2: 'rgba( 38, 166, 154, 0.05)', bottomLineColor: 'rgba( 239, 83, 80, 1)', bottomFillColor1: 'rgba( 239, 83, 80, 0.05)', bottomFillColor2: 'rgba( 239, 83, 80, 0.28)' });
    const data = [{ value: 1, time: 1642425322 }, { value: 8, time: 1642511722 }, { value: 10, time: 1642598122 }, { value: 20, time: 1642684522 }, { value: 3, time: 1642770922 }, { value: 43, time: 1642857322 }, { value: 41, time: 1642943722 }, { value: 43, time: 1643030122 }, { value: 56, time: 1643116522 }, { value: 46, time: 1643202922 }];
    baselineSeries.setData(data);
    BaselineChart_XMPL.timeScale().fitContent();
}; initBaselineChart_XMPL(); 

function resizeBaselineChart_XMPL(){
    let frame = document.getElementById('baselineFRAME_XMPL');
    let maxWidth = (frame.offsetWidth>800)?700:(frame.offsetWidth<400)?frame.offsetWidth-0:frame.offsetWidth-80;//(frame.offsetWidth*0.1);
    let maxHeight = 100;//(frame.offsetWidth>800)?300:frame.offsetWidth-300;
    if(maxWidth<100){return}
    BaselineChart_XMPL.resize(maxWidth, maxHeight);
}; resizeBaselineChart_XMPL();
//*************************************************END MAIN BASELINE CHART***********
//**EVENT-HANDLERS*****************************************************
window.addEventListener('resize', () => {
    resizeCandlestickChart1();
    resizeBaselineChart_XMPL();
});
//**END EVENT-HANDLERS*****************************************************
</script><!--****************************************END CHART IMPLEMENTATION-->
<script  > //*********************MAIN_APP**************************
// ******DATES *********************DATES*****************************
// const dateTXTStr = document.getElementById('dateTXTStamp');
// dateTXTStam.innerHTML = new Date().getFullYear();
const currentDate = new Date();
const yearNUM = currentDate.getFullYear();
const monthNUM = (currentDate.getMonth() + 1).toString().padStart(2, '0'); // Adding 1 because months are zero-indexed
const dayNUM = currentDate.getDate().toString().padStart(2, '0');
const current_ymd = `YMD_${yearNUM}_${monthNUM}_${dayNUM}`;
// **** END DATES *****************ENDDATES*********************************
const screenHeight = window.innerHeight;
// console.log("Screen Height:", screenHeight, "px");
// **** END HEIGHT *****************ENDHEIGHT*********************************
// **** VIEWS ********************************VIEWS***********************
const TCKR_VIEW = document.getElementById("TCKR_VIEW");
const BANK_VIEW = document.getElementById("BANK_VIEW");
const BOOK_VIEW = document.getElementById("BOOK_VIEW");
const DATA_VIEW = document.getElementById("DATA_VIEW");
const TCKR_VIEW_BTN = document.getElementById("TCKR_VIEW_BTN");
const BANK_VIEW_BTN = document.getElementById("BANK_VIEW_BTN");
const BOOK_VIEW_BTN = document.getElementById("BOOK_VIEW_BTN");
const DATA_VIEW_BTN = document.getElementById("DATA_VIEW_BTN");
const GALLERY_VIEW_BTN = document.getElementById("GALLERY_VIEW_BTN");
const IMPORT_VIEW_BTN = document.getElementById("IMPORT_VIEW_BTN");
const DATA_GALLERY_FRAME = document.getElementById("DATA_GALLERY_FRAME");
const DATA_TICKR_FRAME = document.getElementById("DATA_TICKR_FRAME");
const DATA_TRADE_FRAME = document.getElementById("DATA_TRADE_FRAME");
const DATA_IMPORT_FRAME = document.getElementById("DATA_IMPORT_FRAME");
const render_TICKR_GALLERY = document.getElementById("render_TICKR_GALLERY");
const render_TICKR_DATA = document.getElementById("render_TICKR_DATA");
const render_TRADE_DATA = document.getElementById("render_TRADE_DATA");
const tickr_SELECTOR_YMT = document.getElementById("tickr_SELECTOR_YMT");
const trade_SELECTOR_YMT = document.getElementById("trade_SELECTOR_YMT");
TCKR_VIEW.classList.add('hiddenTab')     //TAB SWITCH
BANK_VIEW.classList.add('hiddenTab')     //TAB SWITCH
DATA_VIEW.classList.add('hiddenTab')     //TAB SWITCH
BOOK_VIEW_BTN.classList.add('selectedMAINBTN') //TAB DEFAULT handle
BOOK_VIEW.classList.remove('hiddenTab') //TAB DEFAULT handle
// setTimeout(init_BOOKZ_TABZ,3000);
DATA_GALLERY_FRAME.classList.remove('hiddenTab')     //TAB DEFAULT
load_GALLERY_FRAME_DATA();
DATA_TICKR_FRAME.classList.add('hiddenTab')     //TAB SWITCH
DATA_TRADE_FRAME.classList.add('hiddenTab')     //TAB SWITCH
DATA_IMPORT_FRAME.classList.add('hiddenTab')     //TAB SWITCH
let EDIT_YMT_RECORD_ID = ''; //persist record editing between views.
let CHART_SELECTIONS = []; //persist chart selections between views. 
let DATA_GALLERY_LIST = `hi there`; 
// ******************************************VIEW METHODS**********
function go_TICKR_VIEW(){ //TAB SWITCH
    remove_VIEW_SELECTED();
    TCKR_VIEW.classList.remove('hiddenTab');     
    TCKR_VIEW_BTN.classList.add('selectedMAINBTN');
    BANK_VIEW.classList.add('hiddenTab');
    BOOK_VIEW.classList.add('hiddenTab');
    DATA_VIEW.classList.add('hiddenTab');
    init_TKRZ_TABZ()
}
function go_BANK_VIEW(){
    remove_VIEW_SELECTED();
    TCKR_VIEW.classList.add('hiddenTab');     
    BANK_VIEW.classList.remove('hiddenTab');
    BANK_VIEW_BTN.classList.add('selectedMAINBTN');
    BOOK_VIEW.classList.add('hiddenTab');
    DATA_VIEW.classList.add('hiddenTab');  
    init_BANKZ_TABZ() 
}
function go_BOOK_VIEW(){
    remove_VIEW_SELECTED();
    TCKR_VIEW.classList.add('hiddenTab');     
    BANK_VIEW.classList.add('hiddenTab');
    BOOK_VIEW.classList.remove('hiddenTab');
    BOOK_VIEW_BTN.classList.add('selectedMAINBTN');
    DATA_VIEW.classList.add('hiddenTab'); 
    init_BOOKZ_TABZ();  
}
function go_DATA_VIEW(){
    remove_VIEW_SELECTED();
    TCKR_VIEW.classList.add('hiddenTab');     
    BANK_VIEW.classList.add('hiddenTab');
    BOOK_VIEW.classList.add('hiddenTab');
    DATA_VIEW.classList.remove('hiddenTab');
    DATA_VIEW_BTN.classList.add('selectedMAINBTN');
    getDataGallery('gallery')
}
function remove_VIEW_SELECTED(){
    TCKR_VIEW_BTN.classList.remove('selectedMAINBTN');     
    BANK_VIEW_BTN.classList.remove('selectedMAINBTN');
    BOOK_VIEW_BTN.classList.remove('selectedMAINBTN');
    DATA_VIEW_BTN.classList.remove('selectedMAINBTN');  
}
function remove_SUB_VIEW_SELECTED(){
    GALLERY_VIEW_BTN.classList.remove('selectedSUBBTN');     
    IMPORT_VIEW_BTN.classList.remove('selectedSUBBTN');
}
function getDataGallery(type){
    if(type==='gallery'){
        DATA_GALLERY_FRAME.classList.remove('hiddenTab');
        load_GALLERY_FRAME_DATA();     
        remove_SUB_VIEW_SELECTED();
        GALLERY_VIEW_BTN.classList.add('selectedSUBBTN')            
        DATA_IMPORT_FRAME.classList.add('hiddenTab')   
        DATA_TICKR_FRAME.classList.add('hiddenTab')     
        DATA_TRADE_FRAME.classList.add('hiddenTab')     
    }else if (type==='edittrade'){
        DATA_GALLERY_FRAME.classList.add('hiddenTab')     
        DATA_IMPORT_FRAME.classList.add('hiddenTab')  
        DATA_TICKR_FRAME.classList.add('hiddenTab')     
        DATA_TRADE_FRAME.classList.remove('hiddenTab')         
    }else if(type==='edittickr'){ 
        DATA_GALLERY_FRAME.classList.add('hiddenTab')     
        DATA_IMPORT_FRAME.classList.add('hiddenTab')    
        DATA_TICKR_FRAME.classList.remove('hiddenTab')     
        DATA_TRADE_FRAME.classList.add('hiddenTab')     
    }else if(type==='import'){ 
        DATA_GALLERY_FRAME.classList.add('hiddenTab')     
        DATA_TICKR_FRAME.classList.add('hiddenTab')     
        DATA_TRADE_FRAME.classList.add('hiddenTab')      
        DATA_IMPORT_FRAME.classList.remove('hiddenTab')    
        remove_SUB_VIEW_SELECTED();
        IMPORT_VIEW_BTN.classList.add('selectedSUBBTN')          
    }
}
function load_GALLERY_FRAME_DATA(){
    let tkrREC = {}, tkrINPUT, tkrROW, editBTN_TKR,editBTN_TRADE;
    render_TICKR_GALLERY.innerHTML=''; //blank out
    for(var i=0; i<bankbookz_DB.TICKR_LIST.length;i++){
        tkrREC = bankbookz_DB.TICKR_LIST[i];
        tkrINPUT = document.createElement('input')
        tkrINPUT.value = tkrREC.tkr;
        tkrINPUT.readOnly = false;
        tkrINPUT.placeholder = "ticker";
        tkrINPUT.classList.add('inputELEM')
        tkrROW = document.createElement('article')
        tkrROW.classList.add('tkrROWZ')
        tkrROW.appendChild(tkrINPUT)
        editBTN_TRADE = document.createElement('button')
        editBTN_TRADE.innerHTML = 'edit TRADE'+'🎢';
        editBTN_TRADE.classList.add('blackBTN')
        editBTN_TRADE.addEventListener("click",(e)=>{ editDataClick(e,'TRADE') });
        tkrROW.appendChild(editBTN_TRADE)
        editBTN_TKR = document.createElement('button')
        editBTN_TKR.innerHTML = 'edit TKR'+'🎪';
        editBTN_TKR.classList.add('blackBTN')
        editBTN_TKR.addEventListener("click",(e)=>{ editDataClick(e,'TKR') });
        tkrROW.appendChild(editBTN_TKR)        
        render_TICKR_GALLERY.appendChild(tkrROW)  
    }
}
function editDataClick(e, datatype){
    let datatgt = e.target.parentElement.children[0].value;
    if(datatype==='TKR'){
        getDataGallery('edittickr'); //show data panel.
        renderTICKRData(datatgt);
    }else if(datatype==='TRADE'){
        getDataGallery('edittrade'); //show data panel.
        renderTRADEData(datatgt);
    }
}
function renderTICKRData(datatgt){
    let dataSTR = '';//,selectionz=[],aSelection,tkrTAG;
    let monthKEYS = Object.keys(bankbookz_DB.TICKR_DATA_MAP_Monthly[datatgt]);
    let moKEY,txnSET=[],txnITEM,itemSTR;
    render_TICKR_DATA.value=''; //blank out
    for(var i=0; i<monthKEYS.length;i++){
        moKEY = monthKEYS[i];
        txnSET = bankbookz_DB.TICKR_DATA_MAP_Monthly[datatgt][moKEY];
        dataSTR += `# Month:${moKEY} --->\n`;
        for(var ii=0; ii< txnSET.length;ii++){
            txnItem = txnSET[ii]
            itemSTR = JSON.stringify(txnItem)+'\n';
            itemSTR = itemSTR.replace(/"open"/g, " \"open\"").replace(/"close"/g, " \"close\"");
            dataSTR += itemSTR;
        }
        dataSTR += `# -----END-MONTH------->\n\n`;
    } 
    if(dataSTR){ render_TICKR_DATA.value = dataSTR; }
}
function renderTRADEData(datatgt){
    let monthKEYS = Object.keys(bankbookz_DB.TRADE_TXNZ_YMT);
    let dataSTR = '',txnSET,txnItem,tkrTAG='';
    render_TRADE_DATA.innerHTML=''; //blank out
    for(var i=0; i<monthKEYS.length;i++){
        moKEY = monthKEYS[i];
        tkrTAG = moKEY.split("_")[2]
        if(tkrTAG!=datatgt){continue}
        txnSET = bankbookz_DB.TRADE_TXNZ_YMT[moKEY];
        dataSTR += `# Month:${moKEY} --->\n`;
        for(var ii=0; ii< txnSET.length;ii++){
            txnItem = txnSET[ii]
            itemSTR = JSON.stringify(txnItem)+'\n';
            dataSTR += itemSTR;
        }
        dataSTR += `# -----END-MONTH------->\n\n`;        
    }  
    if(dataSTR){
        render_TRADE_DATA.value= dataSTR;
    }
}
//--------------------------------------END DATA fns----------------------------------
//---------------------------------IMPORT fns----------------------------------
// function import_BTNClick(importtype){
//     if(importtype==='trades'){
//         save_TradeClick(); //this is save trade edit btn click.
//     }else if (importtype==='tkr'){
//         save_TickerClick(); //This is save tkr edit btn click.
//     }else if (importtype==='imports'){
//         import_TradeClick(); //this is IMPORT btn click, not save.
//     }
// }

let save_TradeClick = ()=>{
    let render_TRADE_DATA = document.getElementById('render_TRADE_DATA');
        let YMT_id, ymdSTR,clearTRADEMap={'YMT_id':true};
        let inputSTR = render_TRADE_DATA.value, inputARR=[], tradeObj={};
        inputSTR = inputSTR.replace(/#(.*?)--->/g, '').replace(/\n/g,'').replace(/}{/g,'},{')
        try {
            inputARR = JSON.parse('['+inputSTR+']');
            //INPUT DATA: for each TXN, find tkr, find YMT, blank out, add.
            for(var i=0; i<inputARR.length;i++){
                tradeObj = inputARR[i];
                YMT_id = tradeObj.ymtID;
                if(!clearTRADEMap[YMT_id]){ //clear MONTH data for OVERRIDE
                    clearTRADEMap[YMT_id] = true; //clear out MONTH... system.
                    bankbookz_DB.TRADE_TXNZ_YMT[YMT_id] = []
                }
                bankbookz_DB.TRADE_TXNZ_YMT[YMT_id].push(tradeObj);
            }
            debugger;
            
            save_BANKBOOKZ_DB();
        } catch (error) {console.log('ERR: Bad data.');}// go_DATA_VIEW(); } //todo msg
    } //END IMPORT CLICK

    function save_TickerClick(){
        debugger;
        let render_TICKR_DATA = document.getElementById('render_TICKR_DATA');
        let tkrSTR, YMT_id, ymdSTR,clearDataMap={'YMT_id':true};
        let inputSTR = render_TICKR_DATA.value, inputARR=[], tkrObj={};
        inputSTR = inputSTR.replace(/#(.*?)--->/g, '').replace(/\n/g,'').replace(/}{/g,'},{')
        try {
            inputARR = JSON.parse('['+inputSTR+']');
            //INPUT DATA: for each TXN, find tkr, find YMT, blank out, add.
            for(var i=0; i<inputARR.length;i++){
                tkrObj = inputARR[i];
                tkrSTR = tkrObj.tkr;
                ymdARR = tkrObj.time.split("-")
                YMT_id = ymdARR[0]+"_"+ymdARR[1]+"_"+tkrSTR;
                if(!clearDataMap[YMT_id]){ //clear MONTH data for OVERRIDE
                    clearDataMap[YMT_id] = true;
                    bankbookz_DB.TICKR_DATA_MAP_Monthly[tkrSTR][YMT_id] = [];
                }
                bankbookz_DB.TICKR_DATA_MAP_Monthly[tkrSTR][YMT_id].push(tkrObj)
            }
            debugger;
            save_BANKBOOKZ_DB();
        } catch (error) {console.log('ERR: Bad data.'); go_DATA_VIEW(); }
    }
function import_TradeClick(){
    let render_TRADE_IMPORT = document.getElementById('render_TRADE_IMPORT');
    let tkrSTR, YMT_id, txnSET=[],txnItem, dupeCNT=0, newCNT=0,txnFound=false;//, ymdSTR,clearDataMap={'YMT_id':true};
    let inputSTR = render_TRADE_IMPORT.value, inputARR=[], txnOBJ={};
    let trackItem, trackedItem=false,untrackedCNT=0;
    try {
        inputARR = JSON.parse(inputSTR);
        for(var i=0; i<inputARR.length;i++){
            txnOBJ = inputARR[i];
            tkrSTR = txnOBJ.tkr;
            // CHECK TRACKED or UNTRACKED
            trackedItem=false;
            for(var f=0; f< bankbookz_DB.TICKR_LIST.length;f++){
                trackItem = bankbookz_DB.TICKR_LIST[f];
                console.log(trackItem.tkr)
                if( trackItem.tkr===tkrSTR ) { //TRACKED ITEM
                    trackedItem=true;
                    untrackedCNT++;
                    break;
                }
            }
            if(!trackedItem){continue;} //SKIP UNTRACKED DATA
            YMT_id = txnOBJ.ymtID;
            txnSET = bankbookz_DB.TRADE_TXNZ_YMT[YMT_id];
            if(!txnSET){ //CREATE NEW MONTH (trade)
                bankbookz_DB.TRADE_TXNZ_YMT[YMT_id] = [];
                txnSET = bankbookz_DB.TRADE_TXNZ_YMT[YMT_id]
            } 
            txnFound=false;
            // CHECK FOR DUPLICATE TRADE TRANSACTIONS.
            for(var ii=0;ii<txnSET.length;ii++){
                txnItem = txnSET[ii];
                if (txnItem.ymtID===txnOBJ.ymtID && txnItem.price===txnOBJ.price && txnItem.shares===txnOBJ.shares)
                { //DUPLICATE RECORD
                    dupeCNT++;
                    txnFound=true;
                    break;
                } 
            }
            if(!txnFound){ //NEW RECORD
                newCNT++;
                // debugger;
                bankbookz_DB.TRADE_TXNZ_YMT[YMT_id].push(txnOBJ);
            }
        }
        console.log(`IMPORTS; NEW recs:${newCNT}, SKIP Dupes:${dupeCNT}, `) 
        console.log(`Untracked transactions: ${untrackedCNT}`) 
        save_BANKBOOKZ_DB();
    } catch (error) {console.log('ERR: Bad data.'); go_DATA_VIEW(); }
}

</script><!--*******************************END VIEW structure LOGIC-->
<script  >  //********TAB VIEW LOGIC**************************
//*********************TICKRZ-LOGIC**********************/
const init_TKRZ_TABZ = ()=>{
    let tkrREC = {}, tkrINPUT, tkrROW;
    let TKR_RENDER_FRAME = document.getElementById('TKR_RENDER_FRAME');
    TKR_RENDER_FRAME.innerHTML=''; //blank out
    for(var i=0; i<bankbookz_DB.TICKR_LIST.length;i++){
        tkrREC = bankbookz_DB.TICKR_LIST[i];
        tkrINPUT = document.createElement('input')
        tkrINPUT.value = tkrREC.tkr;
        tkrINPUT.readOnly = false;
        tkrINPUT.placeholder = "ticker";
        tkrINPUT.classList.add('inputELEM')
        // tkrINPUT.style.margin='1em 0 1em 0';
        tkrROW = document.createElement('article')
        tkrROW.classList.add('tkrROWZ')
        tkrROW.appendChild(tkrINPUT)
        delBTN = document.createElement('button')
        delBTN.innerHTML = '🗑️'
        delBTN.classList.add('blackBTN')
        delBTN.addEventListener("click",(e)=>{ deleteTickerClick() });
        tkrROW.appendChild(delBTN)
        TKR_RENDER_FRAME.appendChild(tkrROW)  
    }
}
const add_TKRZ_Click = ()=>{ }
//*********************END TKRZ- TAB - LOGIC**********************/
//*********************BANKZ- TAB - LOGIC**********************/
const init_BANKZ_TABZ = ()=>{
    let tkrREC = {}, tkrINPUT, tkrROW, delBTN;
    let MARGINZ_RENDER_FRAME = document.getElementById('MARGINZ_RENDER_FRAME');
    MARGINZ_RENDER_FRAME.innerHTML=''; //blank out
    for(var i=0; i<bankbookz_DB.TICKR_LIST.length;i++){
        tkrREC = bankbookz_DB.TICKR_LIST[i];
        tkrINPUT = document.createElement('input')
        tkrINPUT.value = tkrREC.tkr;
        tkrINPUT.readOnly = false;
        tkrINPUT.placeholder = "ticker";
        tkrINPUT.classList.add('inputELEM')
        tkrINPUT.style.margin='1em 0 1em 0';
        tkrROW = document.createElement('article')
        tkrROW.classList.add('tkrROWZ')
        tkrROW.appendChild(tkrINPUT)
        delBTN = document.createElement('button')
        delBTN.innerHTML = '🗑️'
        delBTN.classList.add('blackBTN')
        delBTN.addEventListener("click",(e)=>{ deleteTickerClick() });
        tkrROW.appendChild(delBTN)
        MARGINZ_RENDER_FRAME.appendChild(tkrROW)  
    }
}
// const add_BANKZ_Click = ()=>{ }
//*********************END BANKZ- TAB - LOGIC**********************/
</script><!--*******************************END VIEW structure LOGIC-->
<script  >  //*********************BOOKZ-LOGIC**********************/
//*********************BOOKZ- TAB - LOGIC**********************/
const init_BOOKZ_TABZ = ()=>{
    let BOOKZ_RENDER_FRAME = document.getElementById('BOOKZ_RENDER_FRAME');
    BOOKZ_RENDER_FRAME.innerHTML=''; //blank out
    let bookFrame_Model = ``, tgtTKR={};
    for(var i=0; i< bankbookz_DB.TICKR_LIST.length; i++){
        tgtTKR = bankbookz_DB.TICKR_LIST[i];
        bookFrame_Model = `
        <section id="BOOKFRAME_${tgtTKR.tkr}" class="BOOKFRAME_Item">
                <header class="mainTitle expanderROW">
                    <span>${tgtTKR.tkr}</span>
                    <span class="expanderBTN" style="font-size:0.777em;" onclick="expander_BOOKZ_Click(event)">✧</span>
                </header>
                <article id="candlestickTITLES_${tgtTKR.tkr}" 
                    style="justify-content:center;flex:1; display:flex;
                    width:98%;padding: 0.444em;color: limegreen;">
                    <i>Loading...</i>
                </article>
                <article id="candlestickFRAME_${tgtTKR.tkr}" class="dynamicCandleStick" style="justify-content:center;
                    flex:1; display:flex;border:solid 1px steelblue;border-radius:22.222px;width:98%">
                    <i>Loading...</i>
                </article>
                <menu style="justify-content: space-evenly; border-radius: 13px;display: flex; 
                    margin-top: 0;padding: 1em 0 0 0;">
                    <span>
                        <div style="background:#26a69a;border-radius:100%;border:solid 1px steelblue;height:0.5em;width:0.5em;display: inline-block;
                        margin-right: 0.5em;"></div>
                        <span style="font-size:0.444em;">PRICE</span>
                    </span>
                    <span>
                        <div style="background:#2962ff;border-radius:100%;border:solid 1px steelblue;height:0.5em;width:0.5em;display: inline-block;
                        margin-right: 0.5em;"></div>
                        <span style="font-size:0.444em;">PROFITnLOSS</span>
                    </span>
                    <span>
                        <select id="DYNA_YMT_SELECTOR_${tgtTKR.tkr}"" class="chartSELECTOR">
                            <option value="true" selected>Last 30</option>
                        </select>
                    </span>
                </menu>
                <section style="justify-content: center;margin-top:1em;flex-direction: column; padding:0 2% 0 2%;
                border-radius: 13px; flex:1; display:flex;border:solid 1px teal;width:90%;margin: 1em auto;">
                    <header class="expanderROW">
                        <span class="expanderTITLE">PnL:</span>
                        <span class="expanderBTN" onclick="MINMAX(event.target)">✧</span>
                    </header>
                    <article id="baselineFRAME_${tgtTKR.tkr}" class="dynamicBaseline" style="display:flex;justify-content:center;flex:1;">
                    </article>
                    <footer style="font-size:0.888em;margin-bottom:1em;display:flex;
                        justify-content:space-between; padding: 0em 3em 0 2em">
                        <span>
                            <div style="background:#26a69a;border-radius:100%;border:solid 1px steelblue;height:0.5em;width:0.5em;display: inline-block;
                            margin-right: 0.5em;"></div>
                            <span style="font-size:0.666em;">BANK:</span>
                            <span style="font-size:0.666em;">444</span>
                        </span>                        
                        <span>
                            <div style="background:#26a69a;border-radius:100%;border:solid 1px steelblue;height:0.5em;width:0.5em;display: inline-block;
                            margin-right: 0.5em;"></div>
                            <span style="font-size:0.666em;">BOOK:</span>
                            <span style="font-size:0.666em;">1,234</span>
                        </span>
                        <span>
                            <div style="background:#26a69a;border-radius:100%;border:solid 1px steelblue;height:0.5em;width:0.5em;display: inline-block;
                            margin-right: 0.5em;"></div>                        
                            <span style="font-size:0.666em;margin-top: 0.333em;color:steelblue">NET(PnL):</span>
                            <span style="font-size:0.666em;">234</span>
                        </span>

                    </footer>                  
                </section>            
                <menu id="dataFRAME_${tgtTKR.tkr}" class="FRAME" style="justify-content: center;
                    border-radius: 13px; flex:1; display:flex;flex-direction: column;padding-top: 0.111em;padding-bottom: 0.222em;">
                    <header class="expanderROW">
                        <span class="expanderTITLE">METADATA:</span>
                        <span class="expanderBTN" onclick="MINMAX(event.target)">✴</span>
                    </header>
                    <section style="display:none;">...</section>
                </menu>
            </section><!--end BOOKFRAME-->         
        `;
        BOOKZ_RENDER_FRAME.innerHTML += bookFrame_Model; 
    }//END BUILD LOOP
    init_BOOKZ_EXPANDER();
    setTimeout(render_ALL_BOOKZ_CHARTZ,222);
    setTimeout(render_ALL_DYNA_SELECTORZ,222);

};init_BOOKZ_TABZ();
function render_ALL_BOOKZ_CHARTZ(){
    let tgt_Candle,tgtTKR; //Render all CANDLESTICK DYNA_CHARTZ
    const All_DynaCandles = document.getElementsByClassName('dynamicCandleStick')
    DYNA_CHART_CANDLES = []; //blank out. for screen resize
    for(var i=0; i<All_DynaCandles.length;i++){
        tgt_Candle = All_DynaCandles[i];
        init_DYNA_CHART_Candle(tgt_Candle);
    }
    let tgt_Baseline; //Render all BASELINE DYNA_CHARTZ
    const All_Dynabaselines = document.getElementsByClassName('dynamicBaseline')
    DYNA_CHART_BASELINES = []; //blank out. for screen resize
    for(var j=0; j<All_Dynabaselines.length;j++){
        tgt_Baseline = All_Dynabaselines[j];
        init_DYNA_CHART_Baseline(tgt_Baseline);
    }  
    // for(var k=0; k<bankbookz_DB.TICKR_LIST.length;k++){
    //     tgtTKR = bankbookz_DB.TICKR_LIST[k];
    //     init_DYNA_SELECTOR(tgtTKR);
    // }  
}
function render_ALL_DYNA_SELECTORZ(){
    let tgtTKR;
    for(var k=0; k<bankbookz_DB.TICKR_LIST.length;k++){
        tgtTKR = bankbookz_DB.TICKR_LIST[k].tkr;
        init_DYNA_SELECTOR(tgtTKR);
    }   
}
function init_BOOKZ_EXPANDER(){ //collapse all BOOKZ except expanded tabs in local storage,
    let tgtTKR='',viewTKR='',viewID='',expanded=false, tgtBTN;
    const allBookz = document.getElementsByClassName('BOOKFRAME_Item');
    for(var j=0; j<allBookz.length;j++){ //collapse all except selected.
        viewID = viewTKR=allBookz[j].id;
        if(!viewID){continue}
        viewID = viewID.split('_')[1]
        if(!viewID){continue}
        expanded = false;
        for(var i=0; i<bankbookz_DB.METASTATE.BOOKZ_EXPANDER.length;i++){
            tgtTKR=bankbookz_DB.METASTATE.BOOKZ_EXPANDER[i];
            if(viewID===tgtTKR){ expanded = true; break; }
        }
        tgtBTN = allBookz[j].children[0].children[1];
        if(expanded){
            loadBookSelection(viewID);
            MINMAX(tgtBTN,expanded);
        }else if(!expanded){
            MINMAX(tgtBTN,expanded);
        }
    }
}; 
function expander_BOOKZ_Click(e){
    let TGT = e.target;
    MINMAX(TGT);
    saveBookSelection(TGT);
    let CURR_STATE = TGT.innerHTML;
    if(CURR_STATE!='✴'){//only load on expand (collapse icon)
        let viewID = TGT.parentElement.parentElement.id;
        let viewTKR = viewID.split('_')[1];    
        loadBookSelection(viewTKR);
    }
}
function loadBookSelection(viewTKR){
    if(viewTKR==='XMPL'){return}
    // console.log('LOAD DATA',viewTKR)
    //todo expand and collapse views.
}
function saveBookSelection(TGT){
    let CURR_STATE = TGT.innerHTML;
    let viewID = TGT.parentElement.parentElement.id;
    let viewTKR = viewID.split('_')[1];
    let lookupIDX = bankbookz_DB.METASTATE.BOOKZ_EXPANDER.indexOf(viewTKR)
    if(CURR_STATE==='✴'){ //add singular to BOOKZ_EXPANDER
        if(lookupIDX>-1){
            bankbookz_DB.METASTATE.BOOKZ_EXPANDER.splice(lookupIDX,1)
            save_BANKBOOKZ_DB();
        }
    }else{ //remove from BOOKZ_EXPANDER.
        if(lookupIDX<0){
            bankbookz_DB.METASTATE.BOOKZ_EXPANDER.push(viewTKR)
            save_BANKBOOKZ_DB();
        }
    }
}
// ******************************************END VIEW METHODS**********
// **** END VIEWS ****************************END VIEWS***************************
</script><!--*****************************END MAIN_APP******************-->
<script  >/****************************************CRYPTO OHLCV API***********/
let stock_api_key = null;//API_KEY - set in local storage.
let init_api_key = ()=>{
   if(localStorage.stock_api_key){
        stock_api_key = localStorage.stock_api_key;
        let status = document.getElementById('connectStatus')
        status.innerHTML='CONNECTED'        
   }
}; 
setTimeout(init_api_key,100);
let setAPIKEY = ()=>{
    let keyINPUT = document.getElementById('keyINPUT');  
    if(keyINPUT.value){
        stock_api_key = keyINPUT.value;
        localStorage.stock_api_key = stock_api_key;
        let status = document.getElementById('connectStatus')
        status.innerHTML='CONNECTED'
    }
}; 
const getCrypto_Loop = async ()=>{
    let tkrTGT='';
    for (const tkrREC of bankbookz_DB.TICKR_LIST){
        tkrTGT = tkrREC.tkr;
        console.log('Request Price Data for:',tkrTGT)
        getCrypto_Daily(tkrTGT)
    }
    setTimeout(save_BANKBOOKZ_DB,3000); //todo?
}
const getCrypto_Daily = async (tkrTGT)=>{
    if(getAPI_Limiter(tkrTGT)){return} //CHECK LastRefreshTime
    if(!stock_api_key){return}
    let url = `https://www.alphavantage.co/query?function=DIGITAL_CURRENCY_DAILY&symbol=${tkrTGT}&market=USD&interval=5min&apikey=${stock_api_key}`;
    fetch(url).then((data)=>{
        if(data.ok){ return data.json();} else{ console.log('err1');}
        }).then((tickResp)=>{
            let tkr = tickResp["Meta Data"]["2. Digital Currency Code"].toUpperCase();
            console.log('SUCCESS:',tkr);
            const tickDaily_RAW = tickResp["Time Series (Digital Currency Daily)"]
            const tickDaily_KEYS = Object.keys(tickDaily_RAW)             
            const tickDaily_TV = [];
            let obj;
            let lastRefreshTime = tickResp["Meta Data"]["6. Last Refreshed"];
            for (const aKey of tickDaily_KEYS) {  //FORMAT TO TRADING VIEW.
                obj = tickDaily_RAW[aKey];
                tickDaily_TV.push({
                    tkr:tkr,
                    time: aKey,     
                    open: parseFloat(obj["1. open"]),
                    high: parseFloat(obj["2. high"]),    
                    low: parseFloat(obj["3. low"]),     
                    close: parseFloat(obj["4. close"]),    
                    volume: Math.round( parseFloat(obj["5. volume"]) )     
                });
            }
            bankbookz_DB.METASTATE.lastRefreshMap[tkr] = lastRefreshTime;
            save_NEW_CRYPTO_DAILY(tickDaily_TV); //skip duplicates, add local storage
            let status = document.getElementById('connectStatus')
            status.innerHTML='UPDATED'

        }).catch((error)=>{
            console.log('err2')
            // showErrorMSG('🛠️ bad request')
            console.log(error)
            let status = document.getElementById('connectStatus')
            status.innerHTML='DISCONNECTED'            
    })
}
function getAPI_Limiter(tkr){
    let lastRefreshDay = bankbookz_DB.METASTATE.lastRefreshMap[tkr].split(' ')[0]
    let dailyLimit = (lastRefreshDay===`${yearNUM}-${monthNUM}-${dayNUM}`)
    if(dailyLimit){console.log('API: Daily Limit '+lastRefreshDay)}
    return dailyLimit;
}
function save_NEW_CRYPTO_DAILY(tickDaily_TV){ //skip duplicates, add local storage
    //DEDUPE:iterate localstorage, if same rec, continue, else, add rec.
    let tkrREC,tkrYMT,txnItem,ymd, ym, YMT,txnFound=false;
    let dupeCNT=0,newCNT=0;
    tickDaily_TV.reverse();//align arrays, chronologically, else chart error.
    for (const aTicker of tickDaily_TV) {
        ymd = aTicker.time.replace(/-/g, "_");
        ym = ymd.split("_")[0] +"_"+ ymd.split("_")[1];
        YMT = ym + '_' + aTicker.tkr //for sub rec 
        ymdt = ymd +'_'+ aTicker.tkr;
        tkrREC = bankbookz_DB.TICKR_DATA_MAP_Monthly[aTicker.tkr];
        if(!tkrREC){ //ORGANIZED BY TKR, then YMT - NEW
            bankbookz_DB.TICKR_DATA_MAP_Monthly[aTicker.tkr] = {}
            tkrREC = bankbookz_DB.TICKR_DATA_MAP_Monthly[aTicker.tkr];
        }
        tkrYMT = tkrREC[YMT]; //GET SUB YMT
        if(!tkrYMT){ //SUB ORGANIZE BY MONTHLY (YMT) - NEW
            bankbookz_DB.TICKR_DATA_MAP_Monthly[aTicker.tkr][YMT] = [];
            tkrYMT = bankbookz_DB.TICKR_DATA_MAP_Monthly[aTicker.tkr][YMT];
        }
        //CHECK FOR DUPLICATE RECORDS.
        txnFound=false;
        for(var ii=0;ii<tkrYMT.length;ii++){
            txnItem = tkrYMT[ii];
            if(!txnItem.time){continue}
            if(aTicker.time===txnItem.time){ //DUPLICATE RECORD
                dupeCNT++;
                txnFound=true;
                break;
            } 
        }
        if(!txnFound){ //NEW RECORD, unshift, else chronological error.
            newCNT++
            bankbookz_DB.TICKR_DATA_MAP_Monthly[aTicker.tkr][YMT].unshift(aTicker)
        }
    }
    console.log(`Response; Dupes:${dupeCNT}, NEW recs:${newCNT}`) 
}
</script><!--*****************************END STOCK DATA API******************-->
<!--***************************** STOCK API INPUT******************-->
<footer id="API_BOX">
    <section id="keyBOX" style="display:flex;border: solid 1px steelblue;
    border-radius: 13px;padding: 2px 6px;color: #022e64;align-items: center;
    margin:1em 1% 1em 1%;">
        API:<input id="keyINPUT"  type="new-password" placeholder="api_key" 
        style="margin-left: 1em; background:#233453;
        border-radius: 10px 0px 0px 10px;"></input>
        <button style="margin-right: 1em; background:#03cbcb;cursor:pointer;
        border-radius: 0px 10px 10px 0px; font-size:0.777em;padding: 4px;" onclick="setAPIKEY();">SET</button>
    </section>  
    <section id="connectStatus" style="font-size: 0.666em;margin-right:2%;color:aqua;">disconnected</section>
    <button id="latestBtn1" class="blackBTN" style="margin:1em 1% 1em 1%;"
        onclick="getCrypto_Loop()">getPrices🔄</button>
</footer>
<!--***************************** END STOCK API INPUT******************-->
<!--***************************** OVERLAY TREND LINES******************-->
<script type="module">
    import {P as lwcprod} from "./module/lwc.prod.js";
    import {g as getRandomDataSet} from "./module/sample-data.js";
    import {TrendLine_Class as TrendLine_Class} from "./module/trendlines.js";
    const TrendLineChart_XMPL = window.chart = lwcprod("trend_line_chart_xmpl", {
        width:400,height:300,
        autoSize:false, layout: {textColor:'steelblue',background: { type: 'solid', color: '#000000' } }
    })
    const lwc_lineSeries = TrendLineChart_XMPL.addLineSeries()
    const  dataSet = getRandomDataSet();
    lwc_lineSeries.setData(dataSet);
    const len = dataSet.length;
    const EndPoint = {
        time: dataSet[len - 50].time,
        price: dataSet[len - 50].value * .9
    }
    const StartPoint = {
        time: dataSet[len - 5].time,
        price: dataSet[len - 5].value * 1.1
    }
    const trendLine1 = new TrendLine_Class(TrendLineChart_XMPL,lwc_lineSeries,EndPoint,StartPoint);
    lwc_lineSeries.attachPrimitive(trendLine1);
    let topEND={},topSTART={};
    topEND.time = EndPoint.time;
    topEND.price = EndPoint.price+10;
    topSTART.time = StartPoint.time;
    topSTART.price = StartPoint.price+200;
    const lineOptions_TOP = {width:1,showLabels:true,lineColor:"rgb(0, 255, 88)",
        labelBackgroundColor: "rgba(255, 255, 255, 0.85)", labelTextColor: "steelblue"
    };            
    const trendLineTOP = new TrendLine_Class(TrendLineChart_XMPL,lwc_lineSeries,topEND,topSTART,lineOptions_TOP);
    lwc_lineSeries.attachPrimitive(trendLineTOP);
    let midEND={},midSTART={};
    midEND.time = EndPoint.time;
    midEND.price = EndPoint.price-10;
    midSTART.time = StartPoint.time;
    midSTART.price = EndPoint.price-10;
    const lineOptions_MID = {width:1,showLabels:true,lineColor:"rgb(0, 144, 188)",
        labelBackgroundColor: "rgba(255, 255, 255, 0.85)", labelTextColor: "steelblue",
        // LineStyle:'Dotted'
    };
    const trendLine_MID = new TrendLine_Class(TrendLineChart_XMPL,lwc_lineSeries,midEND,midSTART,lineOptions_MID);
    lwc_lineSeries.attachPrimitive(trendLine_MID);
    let btmEND={},btmSTART={};
    btmEND.time = EndPoint.time;
    btmEND.price = EndPoint.price-10;
    btmSTART.time = StartPoint.time;
    btmSTART.price = StartPoint.price-200;
    const lineOptions_BTM = {width:1,showLabels:true,lineColor:"rgb(255, 0, 88)",
        labelBackgroundColor: "rgba(255, 255, 255, 0.85)", labelTextColor: "steelblue"
    };
    const trendLine_BTM = new TrendLine_Class(TrendLineChart_XMPL,lwc_lineSeries,btmEND,btmSTART,lineOptions_BTM);
    lwc_lineSeries.attachPrimitive(trendLine_BTM);
</script>
<!--***************************** END OVERLAY LINES******************-->
<legal style="color:darkslategray;font-size: 0.444em;margin: 3.333em 10% 0 10%;
background-color: rgb(9, 0, 18);border-radius: 13px;padding: 1.444em;">
    <div style="margin-top:0;margin-bottom:0em;">
        2020 - <span id="dateTXTStamp"></span><script>
            const dateTXTStamp = document.getElementById('dateTXTStamp');
            dateTXTStamp.innerHTML = new Date().getFullYear();</script> BANKBOOKZ&#8482; by © NetCinematics llc. All rights reserved.
            See License. DESCRIPTION: Template for Personal_Ledger_System. 
            Generative Data Visualization for ARTIFICIAL INTELLIGENCE.
            Charts by <a href="https://www.tradingview.com/">Trading View</a> ♥ ~:).
    </div>
</legal>
<!--[if lt IE 7]>
    <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="#">upgrade your browser</a> to improve your experience.</p>
<![endif]-->
</body>
</html>
